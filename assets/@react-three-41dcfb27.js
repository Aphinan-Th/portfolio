import{_ as Z}from"./@babel-98964cd2.js";import{r as m}from"./react-d344b9d5.js";import{L as Se,T as kt,R as At,U as Lt,a as Dt,O as He,P as $e,S as Ye,b as xe,N as Ft,A as zt,B as It,M as Wt,C as Bt,V,c as Ht,W as $t,d as Nt,e as Gt,f as Ut,g as qt,h as Vt,t as Xt,D as Yt,i as be,j as Zt,k as le,l as Kt,m as Jt,n as Qt}from"./three-2c3a3013.js";import{u as en}from"./react-use-measure-f6074b16.js";import{F as tn,u as nn}from"./its-fine-db4dbd27.js";import{R as rn,c as ae}from"./react-reconciler-de1ac884.js";import{c as on}from"./react-dom-223a3bfd.js";import{c as ze}from"./zustand-cabf8f19.js";import{G as Ne,D as sn,M as Re,O as an}from"./three-stdlib-4ecd233a.js";import{m as st}from"./react-merge-refs-239dbb3c.js";import{s as ln,p as cn,c as un}from"./suspend-react-4f9dedb1.js";var at={exports:{}},lt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(P,S){var M=P.length;P.push(S);e:for(;0<M;){var T=M-1>>>1,R=P[T];if(0<a(R,S))P[T]=S,P[M]=R,M=T;else break e}}function n(P){return P.length===0?null:P[0]}function i(P){if(P.length===0)return null;var S=P[0],M=P.pop();if(M!==S){P[0]=M;e:for(var T=0,R=P.length,B=R>>>1;T<B;){var D=2*(T+1)-1,q=P[D],$=D+1,te=P[$];if(0>a(q,M))$<R&&0>a(te,q)?(P[T]=te,P[$]=M,T=$):(P[T]=q,P[D]=M,T=D);else if($<R&&0>a(te,M))P[T]=te,P[$]=M,T=$;else break e}}return S}function a(P,S){var M=P.sortIndex-S.sortIndex;return M!==0?M:P.id-S.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;e.unstable_now=function(){return c.now()}}else{var g=Date,v=g.now();e.unstable_now=function(){return g.now()-v}}var s=[],h=[],r=1,o=null,u=3,d=!1,p=!1,E=!1,b=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,f=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(P){for(var S=n(h);S!==null;){if(S.callback===null)i(h);else if(S.startTime<=P)i(h),S.sortIndex=S.expirationTime,t(s,S);else break;S=n(h)}}function x(P){if(E=!1,y(P),!p)if(n(s)!==null)p=!0,G(C);else{var S=n(h);S!==null&&F(x,S.startTime-P)}}function C(P,S){p=!1,E&&(E=!1,l(k),k=-1),d=!0;var M=u;try{for(y(S),o=n(s);o!==null&&(!(o.expirationTime>S)||P&&!_());){var T=o.callback;if(typeof T=="function"){o.callback=null,u=o.priorityLevel;var R=T(o.expirationTime<=S);S=e.unstable_now(),typeof R=="function"?o.callback=R:o===n(s)&&i(s),y(S)}else i(s);o=n(s)}if(o!==null)var B=!0;else{var D=n(h);D!==null&&F(x,D.startTime-S),B=!1}return B}finally{o=null,u=M,d=!1}}var w=!1,j=null,k=-1,O=5,A=-1;function _(){return!(e.unstable_now()-A<O)}function L(){if(j!==null){var P=e.unstable_now();A=P;var S=!0;try{S=j(!0,P)}finally{S?H():(w=!1,j=null)}}else w=!1}var H;if(typeof f=="function")H=function(){f(L)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,W=X.port2;X.port1.onmessage=L,H=function(){W.postMessage(null)}}else H=function(){b(L,0)};function G(P){j=P,w||(w=!0,H())}function F(P,S){k=b(function(){P(e.unstable_now())},S)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(P){P.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,G(C))},e.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<P?Math.floor(1e3/P):5},e.unstable_getCurrentPriorityLevel=function(){return u},e.unstable_getFirstCallbackNode=function(){return n(s)},e.unstable_next=function(P){switch(u){case 1:case 2:case 3:var S=3;break;default:S=u}var M=u;u=S;try{return P()}finally{u=M}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(P,S){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var M=u;u=P;try{return S()}finally{u=M}},e.unstable_scheduleCallback=function(P,S,M){var T=e.unstable_now();switch(typeof M=="object"&&M!==null?(M=M.delay,M=typeof M=="number"&&0<M?T+M:T):M=T,P){case 1:var R=-1;break;case 2:R=250;break;case 5:R=1073741823;break;case 4:R=1e4;break;default:R=5e3}return R=M+R,P={id:r++,callback:S,priorityLevel:P,startTime:M,expirationTime:R,sortIndex:-1},M>T?(P.sortIndex=M,t(h,P),n(s)===null&&P===n(h)&&(E?(l(k),k=-1):E=!0,F(x,M-T))):(P.sortIndex=R,t(s,P),p||d||(p=!0,G(C))),P},e.unstable_shouldYield=_,e.unstable_wrapCallback=function(P){var S=u;return function(){var M=u;u=S;try{return P.apply(this,arguments)}finally{u=M}}}})(lt);at.exports=lt;var Ze=at.exports;const Ge={},fn=e=>void Object.assign(Ge,e);function dn(e,t){function n(r,{args:o=[],attach:u,...d},p){let E=`${r[0].toUpperCase()}${r.slice(1)}`,b;if(r==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;b=ie(l,{type:r,root:p,attach:u,primitive:!0})}else{const l=Ge[E];if(!l)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");b=ie(new l(...o),{type:r,root:p,attach:u,memoizedProps:{args:o}})}return b.__r3f.attach===void 0&&(b instanceof It?b.__r3f.attach="geometry":b instanceof Wt&&(b.__r3f.attach="material")),E!=="inject"&&je(b,d),b}function i(r,o){let u=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Te(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),u=!0),u||(p=r.__r3f)==null||p.objects.push(o),o.__r3f||ie(o,{}),o.__r3f.parent=r,We(o),se(o)}}function a(r,o,u){let d=!1;if(o){var p,E;if((p=o.__r3f)!=null&&p.attach)Te(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"});const b=r.children.filter(f=>f!==o),l=b.indexOf(u);r.children=[...b.slice(0,l),o,...b.slice(l)],d=!0}d||(E=r.__r3f)==null||E.objects.push(o),o.__r3f||ie(o,{}),o.__r3f.parent=r,We(o),se(o)}}function c(r,o,u=!1){r&&[...r].forEach(d=>g(o,d,u))}function g(r,o,u){if(o){var d,p,E;if(o.__r3f&&(o.__r3f.parent=null),(d=r.__r3f)!=null&&d.objects&&(r.__r3f.objects=r.__r3f.objects.filter(x=>x!==o)),(p=o.__r3f)!=null&&p.attach)tt(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var b;r.remove(o),(b=o.__r3f)!=null&&b.root&&wn(o.__r3f.root,o)}const f=(E=o.__r3f)==null?void 0:E.primitive,y=u===void 0?o.dispose!==null&&!f:u;if(!f){var l;c((l=o.__r3f)==null?void 0:l.objects,o,y),c(o.children,o,y)}delete o.__r3f,y&&o.dispose&&o.type!=="Scene"&&Ze.unstable_scheduleCallback(Ze.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),se(r)}}function v(r,o,u,d){var p;const E=(p=r.__r3f)==null?void 0:p.parent;if(!E)return;const b=n(o,u,r.__r3f.root);if(r.children){for(const l of r.children)l.__r3f&&i(b,l);r.children=r.children.filter(l=>!l.__r3f)}r.__r3f.objects.forEach(l=>i(b,l)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||g(E,r),b.parent&&(b.__r3f.autoRemovedBeforeAppend=!0),i(E,b),b.raycast&&b.__r3f.eventCount&&b.__r3f.root.getState().internal.interaction.push(b),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=b,l.ref&&(typeof l.ref=="function"?l.ref(b):l.ref.current=b))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:rn({createInstance:n,removeChild:g,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const u=r.getState().scene;u.__r3f&&(u.__r3f.root=r,i(u,o))},removeChildFromContainer:(r,o)=>{o&&g(r.getState().scene,o)},insertInContainerBefore:(r,o,u)=>{if(!o||!u)return;const d=r.getState().scene;d.__r3f&&a(d,o,u)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,u,d){var p;if(((p=r==null?void 0:r.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==r)return[!0];{const{args:b=[],children:l,...f}=d,{args:y=[],children:x,...C}=u;if(!Array.isArray(b))throw new Error("R3F: the args prop must be an array!");if(b.some((j,k)=>j!==y[k]))return[!0];const w=vt(r,f,C,!0);return w.changes.length?[!1,w]:null}},commitUpdate(r,[o,u],d,p,E,b){o?v(r,d,E,b):je(r,u)},commitMount(r,o,u,d){var p;const E=(p=r.__r3f)!=null?p:{};r.raycast&&E.handlers&&E.eventCount&&r.__r3f.root.getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>ie(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:u,parent:d}=(o=r.__r3f)!=null?o:{};u&&d&&tt(d,r,u),r.isObject3D&&(r.visible=!1),se(r)},unhideInstance(r,o){var u;const{attach:d,parent:p}=(u=r.__r3f)!=null?u:{};d&&p&&Te(p,r,d),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),se(r)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():ae.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:je}}var Ke,Je;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,ct=()=>{var e;return(e=Ge.ColorManagement)!=null?e:null},ut=e=>e&&e.isOrthographicCamera,pn=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((Ke=window.document)!=null&&Ke.createElement||((Je=window.navigator)==null?void 0:Je.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function ft(e){const t=m.useRef(e);return ve(()=>void(t.current=e),[e]),t}function mn({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class dt extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}dt.getDerivedStateFromError=()=>({error:!0});const pt="__default",Qe=new Map,vn=e=>e&&!!e.memoized&&!!e.changes;function mt(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const c=I.obj(e);if(c&&i==="reference")return e===t;const g=I.arr(e);if(g&&n==="reference")return e===t;if((g||c)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(c&&n==="shallow"&&i==="shallow"){for(v in a?t:e)if(!I.equ(e[v],t[v],{strict:a,objects:"reference"}))return!1}else for(v in a?t:e)if(e[v]!==t[v])return!1;if(I.und(v)){if(g&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function hn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function gn(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ie(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ie(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return n=i.reduce((c,g)=>c[g],e),{target:n,key:a}}else return{target:n,key:t}}const et=/-\d+$/;function Te(e,t,n){if(I.str(n)){if(et.test(n)){const c=n.replace(et,""),{target:g,key:v}=Ie(e,c);Array.isArray(g[v])||(g[v]=[])}const{target:i,key:a}=Ie(e,n);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=n(e,t)}function tt(e,t,n){var i,a;if(I.str(n)){const{target:c,key:g}=Ie(e,n),v=t.__r3f.previousAttach;v===void 0?delete c[g]:c[g]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function vt(e,{children:t,key:n,ref:i,...a},{children:c,key:g,ref:v,...s}={},h=!1){var r;const o=(r=e==null?void 0:e.__r3f)!=null?r:{},u=Object.entries(a),d=[];if(h){const E=Object.keys(s);for(let b=0;b<E.length;b++)a.hasOwnProperty(E[b])||u.unshift([E[b],pt+"remove"])}u.forEach(([E,b])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&E==="object"||I.equ(b,s[E]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(E))return d.push([E,b,!0,[]]);let f=[];E.includes("-")&&(f=E.split("-")),d.push([E,b,!1,f]);for(const y in a){const x=a[y];y.startsWith(`${E}-`)&&d.push([y,x,!1,y.split("-")])}});const p={...a};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}function je(e,t){var n,i,a;const c=(n=e.__r3f)!=null?n:{},g=c.root,v=(i=g==null||g.getState==null?void 0:g.getState())!=null?i:{},{memoized:s,changes:h}=vn(t)?t:vt(e,t),r=c.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let u=0;u<h.length;u++){let[d,p,E,b]=h[u];if(Oe(e)){const x="srgb",C="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?x:C):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?x:C)}let l=e,f=l[d];if(b.length&&(f=b.reduce((y,x)=>y[x],e),!(f&&f.set))){const[y,...x]=b.reverse();l=x.reverse().reduce((C,w)=>C[w],e),d=y}if(p===pt+"remove")if(l.constructor){let y=Qe.get(l.constructor);y||(y=new l.constructor,Qe.set(l.constructor,y)),p=y[d]}else p=0;if(E)p?c.handlers[d]=p:delete c.handlers[d],c.eventCount=Object.keys(c.handlers).length;else if(f&&f.set&&(f.copy||f instanceof Se)){if(Array.isArray(p))f.fromArray?f.fromArray(p):f.set(...p);else if(f.copy&&p&&p.constructor&&f.constructor===p.constructor)f.copy(p);else if(p!==void 0){const y=f instanceof Bt;!y&&f.setScalar?f.setScalar(p):f instanceof Se&&p instanceof Se?f.mask=p.mask:f.set(p),!ct()&&!v.linear&&y&&f.convertSRGBToLinear()}}else if(l[d]=p,l[d]instanceof kt&&l[d].format===At&&l[d].type===Lt){const y=l[d];Oe(y)&&Oe(v.gl)?y.colorSpace=v.gl.outputColorSpace:y.encoding=v.gl.outputEncoding}se(e)}if(c.parent&&v.internal&&e.raycast&&r!==c.eventCount){const u=v.internal.interaction.indexOf(e);u>-1&&v.internal.interaction.splice(u,1),c.eventCount&&v.internal.interaction.push(e)}return!(h.length===1&&h[0][0]==="onUpdate")&&h.length&&(a=e.__r3f)!=null&&a.parent&&We(e),e}function se(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function We(e){e.onUpdate==null||e.onUpdate(e)}function yn(e,t){e.manual||(ut(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function bn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ae.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ae.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ae.ContinuousEventPriority;default:return ae.DefaultEventPriority}}function ht(e,t,n,i){const a=n.get(t);a&&(n.delete(t),n.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function wn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(a)}),n.capturedMap.forEach((i,a)=>{ht(n.capturedMap,t,i,a)})}function _n(e){function t(s){const{internal:h}=e.getState(),r=s.offsetX-h.initialClick[0],o=s.offsetY-h.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(s){return s.filter(h=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=h.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(s,h){const r=e.getState(),o=new Set,u=[],d=h?h(r.internal.interaction):r.internal.interaction;for(let l=0;l<d.length;l++){const f=fe(d[l]);f&&(f.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(s,r);function p(l){const f=fe(l);if(!f||!f.events.enabled||f.raycaster.camera===null)return[];if(f.raycaster.camera===void 0){var y;f.events.compute==null||f.events.compute(s,f,(y=f.previousRoot)==null?void 0:y.getState()),f.raycaster.camera===void 0&&(f.raycaster.camera=null)}return f.raycaster.camera?f.raycaster.intersectObject(l,!0):[]}let E=d.flatMap(p).sort((l,f)=>{const y=fe(l.object),x=fe(f.object);return!y||!x?l.distance-f.distance:x.events.priority-y.events.priority||l.distance-f.distance}).filter(l=>{const f=we(l);return o.has(f)?!1:(o.add(f),!0)});r.events.filter&&(E=r.events.filter(E,r));for(const l of E){let f=l.object;for(;f;){var b;(b=f.__r3f)!=null&&b.eventCount&&u.push({...l,eventObject:f}),f=f.parent}}if("pointerId"in s&&r.internal.capturedMap.has(s.pointerId))for(let l of r.internal.capturedMap.get(s.pointerId).values())o.has(we(l.intersection))||u.push(l.intersection);return u}function a(s,h,r,o){const u=e.getState();if(s.length){const d={stopped:!1};for(const p of s){const E=fe(p.object)||u,{raycaster:b,pointer:l,camera:f,internal:y}=E,x=new V(l.x,l.y,0).unproject(f),C=A=>{var _,L;return(_=(L=y.capturedMap.get(A))==null?void 0:L.has(p.eventObject))!=null?_:!1},w=A=>{const _={intersection:p,target:h.target};y.capturedMap.has(A)?y.capturedMap.get(A).set(p.eventObject,_):y.capturedMap.set(A,new Map([[p.eventObject,_]])),h.target.setPointerCapture(A)},j=A=>{const _=y.capturedMap.get(A);_&&ht(y.capturedMap,p.eventObject,_,A)};let k={};for(let A in h){let _=h[A];typeof _!="function"&&(k[A]=_)}let O={...p,...k,pointer:l,intersections:s,stopped:d.stopped,delta:r,unprojectedPoint:x,ray:b.ray,camera:f,stopPropagation(){const A="pointerId"in h&&y.capturedMap.get(h.pointerId);if((!A||A.has(p.eventObject))&&(O.stopped=d.stopped=!0,y.hovered.size&&Array.from(y.hovered.values()).find(_=>_.eventObject===p.eventObject))){const _=s.slice(0,s.indexOf(p));c([..._,p])}},target:{hasPointerCapture:C,setPointerCapture:w,releasePointerCapture:j},currentTarget:{hasPointerCapture:C,setPointerCapture:w,releasePointerCapture:j},nativeEvent:h};if(o(O),d.stopped===!0)break}}return s}function c(s){const{internal:h}=e.getState();for(const r of h.hovered.values())if(!s.length||!s.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const u=r.eventObject.__r3f,d=u==null?void 0:u.handlers;if(h.hovered.delete(we(r)),u!=null&&u.eventCount){const p={...r,intersections:s};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function g(s,h){for(let r=0;r<h.length;r++){const o=h[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return h=>{const{internal:r}=e.getState();"pointerId"in h&&r.capturedMap.has(h.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(h.pointerId)&&(r.capturedMap.delete(h.pointerId),c([]))})}}return function(r){const{onPointerMissed:o,internal:u}=e.getState();u.lastEvent.current=r;const d=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",b=i(r,d?n:void 0),l=p?t(r):0;s==="onPointerDown"&&(u.initialClick=[r.offsetX,r.offsetY],u.initialHits=b.map(y=>y.eventObject)),p&&!b.length&&l<=2&&(g(r,u.interaction),o&&o(r)),d&&c(b);function f(y){const x=y.eventObject,C=x.__r3f,w=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(d){if(w.onPointerOver||w.onPointerEnter||w.onPointerOut||w.onPointerLeave){const j=we(y),k=u.hovered.get(j);k?k.stopped&&y.stopPropagation():(u.hovered.set(j,y),w.onPointerOver==null||w.onPointerOver(y),w.onPointerEnter==null||w.onPointerEnter(y))}w.onPointerMove==null||w.onPointerMove(y)}else{const j=w[s];j?(!p||u.initialHits.includes(x))&&(g(r,u.interaction.filter(k=>!u.initialHits.includes(k))),j(y)):p&&u.initialHits.includes(x)&&g(r,u.interaction.filter(k=>!u.initialHits.includes(k)))}}a(b,r,l,f)}}return{handlePointer:v}}const gt=e=>!!(e!=null&&e.render),yt=m.createContext(null),Pn=(e,t)=>{const n=ze((v,s)=>{const h=new V,r=new V,o=new V;function u(l=s().camera,f=r,y=s().size){const{width:x,height:C,top:w,left:j}=y,k=x/C;f instanceof V?o.copy(f):o.set(...f);const O=l.getWorldPosition(h).distanceTo(o);if(ut(l))return{width:x/l.zoom,height:C/l.zoom,top:w,left:j,factor:1,distance:O,aspect:k};{const A=l.fov*Math.PI/180,_=2*Math.tan(A/2)*O,L=_*(x/C);return{width:L,height:_,top:w,left:j,factor:x/L,distance:O,aspect:k}}}let d;const p=l=>v(f=>({performance:{...f.performance,current:l}})),E=new Ht;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,f)=>t(l,f,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Vt,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:l=>v(f=>({...f,events:{...f.events,...l}})),setSize:(l,f,y,x,C)=>{const w=s().camera,j={width:l,height:f,top:x||0,left:C||0,updateStyle:y};v(k=>({size:j,viewport:{...k.viewport,...u(w,r,j)}}))},setDpr:l=>v(f=>{const y=mt(l);return{viewport:{...f.viewport,dpr:y,initialDpr:f.viewport.initialDpr||y}}}),setFrameloop:(l="always")=>{const f=s().clock;f.stop(),f.elapsedTime=0,l!=="never"&&(f.start(),f.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,f,y)=>{const x=s().internal;return x.priority=x.priority+(f>0?1:0),x.subscribers.push({ref:l,priority:f,store:y}),x.subscribers=x.subscribers.sort((C,w)=>C.priority-w.priority),()=>{const C=s().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(f>0?1:0),C.subscribers=C.subscribers.filter(w=>w.ref!==l))}}}}}),i=n.getState();let a=i.size,c=i.viewport.dpr,g=i.camera;return n.subscribe(()=>{const{camera:v,size:s,viewport:h,gl:r,set:o}=n.getState();if(s!==a||h.dpr!==c){var u;a=s,c=h.dpr,yn(v,s),r.setPixelRatio(h.dpr);const d=(u=s.updateStyle)!=null?u:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(s.width,s.height,d)}v!==g&&(g=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),n.subscribe(v=>e(v)),n};let _e,En=new Set,Cn=new Set,Mn=new Set;function ke(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function de(e,t){switch(e){case"before":return ke(En,t);case"after":return ke(Cn,t);case"tail":return ke(Mn,t)}}let Ae,Le;function De(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Ae=t.internal.subscribers,_e=0;_e<Ae.length;_e++)Le=Ae[_e],Le.ref.current(Le.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Sn(e){let t=!1,n,i,a;function c(s){i=requestAnimationFrame(c),t=!0,n=0,de("before",s);for(const r of e.values()){var h;a=r.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((h=a.gl.xr)!=null&&h.isPresenting)&&(n+=De(s,a))}if(de("after",s),n===0)return de("tail",s),t=!1,cancelAnimationFrame(i)}function g(s,h=1){var r;if(!s)return e.forEach(o=>g(o.store.getState()),h);(r=s.gl.xr)!=null&&r.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+h),t||(t=!0,requestAnimationFrame(c)))}function v(s,h=!0,r,o){if(h&&de("before",s),r)De(s,r,o);else for(const u of e.values())De(s,u.store.getState());h&&de("after",s)}return{loop:c,invalidate:g,advance:v}}function bt(){const e=m.useContext(yt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function U(e=n=>n,t){return bt()(e,t)}function Ce(e,t=0){const n=bt(),i=n.getState().internal.subscribe,a=ft(e);return ve(()=>i(a,t,n),[t,i,n]),null}function wt(e,t){return function(n,...i){const a=new n;return e&&e(a),Promise.all(i.map(c=>new Promise((g,v)=>a.load(c,s=>{s.scene&&Object.assign(s,hn(s.scene)),g(s)},t,s=>v(new Error(`Could not load ${c}: ${s.message})`))))))}}function he(e,t,n,i){const a=Array.isArray(t)?t:[t],c=ln(wt(n,i),[e,...a],{equal:I.equ});return Array.isArray(t)?c:c[0]}he.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return cn(wt(n),[e,...i])};he.clear=function(e,t){const n=Array.isArray(t)?t:[t];return un([e,...n])};const ce=new Map,{invalidate:nt,advance:rt}=Sn(ce),{reconciler:Ee,applyProps:re}=dn(ce,bn),oe={objects:"shallow",strict:!1},xn=(e,t)=>{const n=typeof e=="function"?e(t):e;return gt(n)?n:new $t({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Rn(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:n,height:i,top:a,left:c}=e.parentElement.getBoundingClientRect();return{width:n,height:i,top:a,left:c}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function On(e){const t=ce.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,c=i||Pn(nt,rt),g=n||Ee.createContainer(c,ae.ConcurrentRoot,null,!1,null,"",a,null);t||ce.set(e,{fiber:g,store:c});let v,s=!1,h;return{configure(r={}){let{gl:o,size:u,scene:d,events:p,onCreated:E,shadows:b=!1,linear:l=!1,flat:f=!1,legacy:y=!1,orthographic:x=!1,frameloop:C="always",dpr:w=[1,2],performance:j,raycaster:k,camera:O,onPointerMissed:A}=r,_=c.getState(),L=_.gl;_.gl||_.set({gl:L=xn(o,e)});let H=_.raycaster;H||_.set({raycaster:H=new Dt});const{params:X,...W}=k||{};if(I.equ(W,H,oe)||re(H,{...W}),I.equ(X,H.params,oe)||re(H,{params:{...H.params,...X}}),!_.camera||_.camera===h&&!I.equ(h,O,oe)){h=O;const T=O instanceof Nt,R=T?O:x?new He(0,0,0,0,.1,1e3):new $e(75,0,.1,1e3);T||(R.position.z=5,O&&re(R,O),!_.camera&&!(O!=null&&O.rotation)&&R.lookAt(0,0,0)),_.set({camera:R})}if(!_.scene){let T;d instanceof Ye?T=d:(T=new Ye,d&&re(T,d)),_.set({scene:ie(T)})}if(!_.xr){const T=(D,q)=>{const $=c.getState();$.frameloop!=="never"&&rt(D,!0,$,q)},R=()=>{const D=c.getState();D.gl.xr.enabled=D.gl.xr.isPresenting,D.gl.xr.setAnimationLoop(D.gl.xr.isPresenting?T:null),D.gl.xr.isPresenting||nt(D)},B={connect(){const D=c.getState().gl;D.xr.addEventListener("sessionstart",R),D.xr.addEventListener("sessionend",R)},disconnect(){const D=c.getState().gl;D.xr.removeEventListener("sessionstart",R),D.xr.removeEventListener("sessionend",R)}};L.xr&&B.connect(),_.set({xr:B})}if(L.shadowMap){const T=L.shadowMap.enabled,R=L.shadowMap.type;if(L.shadowMap.enabled=!!b,I.boo(b))L.shadowMap.type=xe;else if(I.str(b)){var G;const B={basic:Gt,percentage:Ut,soft:xe,variance:qt};L.shadowMap.type=(G=B[b])!=null?G:xe}else I.obj(b)&&Object.assign(L.shadowMap,b);(T!==L.shadowMap.enabled||R!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}const F=ct();F&&("enabled"in F?F.enabled=!y:"legacyMode"in F&&(F.legacyMode=y)),re(L,{outputEncoding:l?3e3:3001,toneMapping:f?Ft:zt}),_.legacy!==y&&_.set(()=>({legacy:y})),_.linear!==l&&_.set(()=>({linear:l})),_.flat!==f&&_.set(()=>({flat:f})),o&&!I.fun(o)&&!gt(o)&&!I.equ(o,L,oe)&&re(L,o),p&&!_.events.handlers&&_.set({events:p(c)});const M=Rn(e,u);return I.equ(M,_.size,oe)||_.setSize(M.width,M.height,M.updateStyle,M.top,M.left),w&&_.viewport.dpr!==mt(w)&&_.setDpr(w),_.frameloop!==C&&_.setFrameloop(C),_.onPointerMissed||_.set({onPointerMissed:A}),j&&!I.equ(j,_.performance,oe)&&_.set(T=>({performance:{...T.performance,...j}})),v=E,s=!0,this},render(r){return s||this.configure(),Ee.updateContainer(m.createElement(Tn,{store:c,children:r,onCreated:v,rootElement:e}),g,null,()=>{}),c},unmount(){_t(e)}}}function Tn({store:e,children:t,onCreated:n,rootElement:i}){return ve(()=>{const a=e.getState();a.set(c=>({internal:{...c.internal,active:!0}})),n&&n(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),m.createElement(yt.Provider,{value:e},t)}function _t(e,t){const n=ce.get(e),i=n==null?void 0:n.fiber;if(i){const a=n==null?void 0:n.store.getState();a&&(a.internal.active=!1),Ee.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var c,g,v,s;a.events.disconnect==null||a.events.disconnect(),(c=a.gl)==null||(g=c.renderLists)==null||g.dispose==null||g.dispose(),(v=a.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),gn(a),ce.delete(e),t&&t(e)}catch{}},500)})}}Ee.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function jn(e){const{handlePointer:t}=_n(e);return{priority:1,enabled:!0,compute(n,i,a){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:a}=e.getState();(n=a.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:n=>{var i;const{set:a,events:c}=e.getState();c.disconnect==null||c.disconnect(),a(g=>({events:{...g.events,connected:n}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([g,v])=>{const[s,h]=Fe[g];n.addEventListener(s,v,{passive:h})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([c,g])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Fe[c];i.connected.removeEventListener(v,g)}}),n(c=>({events:{...c.events,connected:void 0}}))}}}}const kn=m.forwardRef(function({children:t,fallback:n,resize:i,style:a,gl:c,events:g=jn,eventSource:v,eventPrefix:s,shadows:h,linear:r,flat:o,legacy:u,orthographic:d,frameloop:p,dpr:E,performance:b,raycaster:l,camera:f,onPointerMissed:y,onCreated:x,...C},w){m.useMemo(()=>fn(Xt),[]);const j=nn(),[k,O]=en({scroll:!0,debounce:{scroll:50,resize:0},...i}),A=m.useRef(null),_=m.useRef(null);m.useImperativeHandle(w,()=>A.current);const L=ft(y),[H,X]=m.useState(!1),[W,G]=m.useState(!1);if(H)throw H;if(W)throw W;const F=m.useRef(null);ve(()=>{const S=A.current;O.width>0&&O.height>0&&S&&(F.current||(F.current=On(S)),F.current.configure({gl:c,events:g,shadows:h,linear:r,flat:o,legacy:u,orthographic:d,frameloop:p,dpr:E,performance:b,raycaster:l,camera:f,size:O,onPointerMissed:(...M)=>L.current==null?void 0:L.current(...M),onCreated:M=>{M.events.connect==null||M.events.connect(v?pn(v)?v.current:v:_.current),s&&M.setEvents({compute:(T,R)=>{const B=T[s+"X"],D=T[s+"Y"];R.pointer.set(B/R.size.width*2-1,-(D/R.size.height)*2+1),R.raycaster.setFromCamera(R.pointer,R.camera)}}),x==null||x(M)}}),F.current.render(m.createElement(j,null,m.createElement(dt,{set:G},m.createElement(m.Suspense,{fallback:m.createElement(mn,{set:X})},t)))))}),m.useEffect(()=>{const S=A.current;if(S)return()=>_t(S)},[]);const P=v?"none":"auto";return m.createElement("div",Z({ref:_,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:P,...a}},C),m.createElement("div",{ref:k,style:{width:"100%",height:"100%"}},m.createElement("canvas",{ref:A,style:{display:"block"}},n)))}),or=m.forwardRef(function(t,n){return m.createElement(tn,null,m.createElement(kn,Z({},t,{ref:n})))}),ge=new V,Ue=new V,An=new V;function Ln(e,t,n){const i=ge.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=n.width/2,c=n.height/2;return[i.x*a+a,-(i.y*c)+c]}function Dn(e,t){const n=ge.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),a=n.sub(i),c=t.getWorldDirection(An);return a.angleTo(c)>Math.PI/2}function Fn(e,t,n,i){const a=ge.setFromMatrixPosition(e.matrixWorld),c=a.clone();c.project(t),n.setFromCamera(c,t);const g=n.intersectObjects(i,!0);if(g.length){const v=g[0].distance;return a.distanceTo(n.ray.origin)<v}return!0}function zn(e,t){if(t instanceof He)return t.zoom;if(t instanceof $e){const n=ge.setFromMatrixPosition(e.matrixWorld),i=Ue.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,c=n.distanceTo(i);return 1/(2*Math.tan(a/2)*c)}else return 1}function In(e,t,n){if(t instanceof $e||t instanceof He){const i=ge.setFromMatrixPosition(e.matrixWorld),a=Ue.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(a),g=(n[1]-n[0])/(t.far-t.near),v=n[1]-g*t.far;return Math.round(g*c+v)}}const Be=e=>Math.abs(e)<1e-10?0:e;function Pt(e,t,n=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=Be(t[a]*e.elements[a])+(a!==15?",":")");return n+i}const Wn=(e=>t=>Pt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Bn=(e=>(t,n)=>Pt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Hn(e){return e&&typeof e=="object"&&"current"in e}const ir=m.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:a,center:c,fullscreen:g,portal:v,distanceFactor:s,sprite:h=!1,transform:r=!1,occlude:o,onOcclude:u,castShadow:d,receiveShadow:p,material:E,geometry:b,zIndexRange:l=[16777271,0],calculatePosition:f=Ln,as:y="div",wrapperClass:x,pointerEvents:C="auto",...w},j)=>{const{gl:k,camera:O,scene:A,size:_,raycaster:L,events:H,viewport:X}=U(),[W]=m.useState(()=>document.createElement(y)),G=m.useRef(),F=m.useRef(null),P=m.useRef(0),S=m.useRef([0,0]),M=m.useRef(null),T=m.useRef(null),R=(v==null?void 0:v.current)||H.connected||k.domElement.parentNode,B=m.useRef(null),D=m.useRef(!1),q=m.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Hn(o[0]),[o]);m.useLayoutEffect(()=>{const N=k.domElement;o&&o==="blending"?(N.style.zIndex=`${Math.floor(l[0]/2)}`,N.style.position="absolute",N.style.pointerEvents="none"):(N.style.zIndex=null,N.style.position=null,N.style.pointerEvents=null)},[o]),m.useLayoutEffect(()=>{if(F.current){const N=G.current=on(W);if(A.updateMatrixWorld(),r)W.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const z=f(F.current,O,_);W.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${z[0]}px,${z[1]}px,0);transform-origin:0 0;`}return R&&(a?R.prepend(W):R.appendChild(W)),()=>{R&&R.removeChild(W),N.unmount()}}},[R,r]),m.useLayoutEffect(()=>{x&&(W.className=x)},[x]);const $=m.useMemo(()=>r?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...g&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...n},[n,c,g,_,r]),te=m.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);m.useLayoutEffect(()=>{if(D.current=!1,r){var N;(N=G.current)==null||N.render(m.createElement("div",{ref:M,style:$},m.createElement("div",{ref:T,style:te},m.createElement("div",{ref:j,className:i,style:n,children:e}))))}else{var z;(z=G.current)==null||z.render(m.createElement("div",{ref:j,style:$,className:i,children:e}))}});const ne=m.useRef(!0);Ce(N=>{if(F.current){O.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const z=r?S.current:f(F.current,O,_);if(r||Math.abs(P.current-O.zoom)>t||Math.abs(S.current[0]-z[0])>t||Math.abs(S.current[1]-z[1])>t){const K=Dn(F.current,O);let Y=!1;q&&(o!=="blending"?Y=[A]:Array.isArray(o)&&(Y=o.map(J=>J.current)));const ue=ne.current;if(Y){const J=Fn(F.current,O,L,Y);ne.current=J&&!K}else ne.current=!K;ue!==ne.current&&(u?u(!ne.current):W.style.display=ne.current?"block":"none");const ye=Math.floor(l[0]/2),Mt=o?q?[l[0],ye]:[ye-1,0]:l;if(W.style.zIndex=`${In(F.current,O,Mt)}`,r){const[J,Ve]=[_.width/2,_.height/2],Me=O.projectionMatrix.elements[5]*Ve,{isOrthographicCamera:Xe,top:St,left:xt,bottom:Rt,right:Ot}=O,Tt=Wn(O.matrixWorldInverse),jt=Xe?`scale(${Me})translate(${Be(-(Ot+xt)/2)}px,${Be((St+Rt)/2)}px)`:`translateZ(${Me}px)`;let Q=F.current.matrixWorld;h&&(Q=O.matrixWorldInverse.clone().transpose().copyPosition(Q).scale(F.current.scale),Q.elements[3]=Q.elements[7]=Q.elements[11]=0,Q.elements[15]=1),W.style.width=_.width+"px",W.style.height=_.height+"px",W.style.perspective=Xe?"":`${Me}px`,M.current&&T.current&&(M.current.style.transform=`${jt}${Tt}translate(${J}px,${Ve}px)`,T.current.style.transform=Bn(Q,1/((s||10)/400)))}else{const J=s===void 0?1:zn(F.current,O)*s;W.style.transform=`translate3d(${z[0]}px,${z[1]}px,0) scale(${J})`}S.current=z,P.current=O.zoom}}if(!q&&B.current&&!D.current)if(r){if(M.current){const z=M.current.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const{isOrthographicCamera:K}=O;if(K||b)w.scale&&(Array.isArray(w.scale)?w.scale instanceof V?B.current.scale.copy(w.scale.clone().divideScalar(1)):B.current.scale.set(1/w.scale[0],1/w.scale[1],1/w.scale[2]):B.current.scale.setScalar(1/w.scale));else{const Y=(s||10)/400,ue=z.clientWidth*Y,ye=z.clientHeight*Y;B.current.scale.set(ue,ye,1)}D.current=!0}}}else{const z=W.children[0];if(z!=null&&z.clientWidth&&z!=null&&z.clientHeight){const K=1/X.factor,Y=z.clientWidth*K,ue=z.clientHeight*K;B.current.scale.set(Y,ue,1),D.current=!0}B.current.lookAt(N.camera.position)}});const qe=m.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return m.createElement("group",Z({},w,{ref:F}),o&&!q&&m.createElement("mesh",{castShadow:d,receiveShadow:p,ref:B},b||m.createElement("planeGeometry",null),E||m.createElement("shaderMaterial",{side:Yt,vertexShader:qe.vertexShader,fragmentShader:qe.fragmentShader})))}),$n=ze.default||ze;let pe=0;const sr=$n(e=>(be.onStart=(t,n,i)=>{e({active:!0,item:t,loaded:n,total:i,progress:(n-pe)/(i-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(n=>({errors:[...n.errors,t]})),be.onProgress=(t,n,i)=>{n===i&&(pe=i),e({active:!0,item:t,loaded:n,total:i,progress:(n-pe)/(i-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));let Pe=null;function Et(e,t,n){return i=>{n&&n(i),e&&(Pe||(Pe=new sn),Pe.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(Pe)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function Ct(e,t=!0,n=!0,i){return he(Ne,e,Et(t,n,i))}Ct.preload=(e,t=!0,n=!0,i)=>he.preload(Ne,e,Et(t,n,i));Ct.clear=e=>he.clear(Ne,e);const ar=m.forwardRef(({makeDefault:e,camera:t,regress:n,domElement:i,enableDamping:a=!0,keyEvents:c=!1,onChange:g,onStart:v,onEnd:s,...h},r)=>{const o=U(w=>w.invalidate),u=U(w=>w.camera),d=U(w=>w.gl),p=U(w=>w.events),E=U(w=>w.setEvents),b=U(w=>w.set),l=U(w=>w.get),f=U(w=>w.performance),y=t||u,x=i||p.connected||d.domElement,C=m.useMemo(()=>new an(y),[y]);return Ce(()=>{C.enabled&&C.update()},-1),m.useEffect(()=>(c&&C.connect(c===!0?x:c),C.connect(x),()=>void C.dispose()),[c,x,n,C,o]),m.useEffect(()=>{const w=O=>{o(),n&&f.regress(),g&&g(O)},j=O=>{v&&v(O)},k=O=>{s&&s(O)};return C.addEventListener("change",w),C.addEventListener("start",j),C.addEventListener("end",k),()=>{C.removeEventListener("start",j),C.removeEventListener("end",k),C.removeEventListener("change",w)}},[g,v,s,C,o,E]),m.useEffect(()=>{if(e){const w=l().controls;return b({controls:C}),()=>b({controls:w})}},[e,C]),m.createElement("primitive",Z({ref:r,object:C,enableDamping:a},h))});class Nn extends Zt{constructor(t){super(t),this.onBeforeCompile=(n,i)=>{const{isWebGL2:a}=i.capabilities;n.fragmentShader=n.fragmentShader.replace("#include <output_fragment>",`
        ${a?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const lr=m.forwardRef((e,t)=>{const[n]=m.useState(()=>new Nn(null));return m.createElement("primitive",Z({},e,{object:n,ref:t,attach:"material"}))});let ee,me;const Gn=m.createContext(null),ot=new Kt,it=new V,Un=m.forwardRef(({children:e,range:t,limit:n=1e3,...i},a)=>{const c=m.useRef(null),[g,v]=m.useState([]),[[s,h,r]]=m.useState(()=>[new Float32Array(n*3),Float32Array.from({length:n*3},()=>1),Float32Array.from({length:n},()=>1)]);m.useEffect(()=>{c.current.geometry.attributes.position.needsUpdate=!0}),Ce(()=>{for(c.current.updateMatrix(),c.current.updateMatrixWorld(),ot.copy(c.current.matrixWorld).invert(),c.current.geometry.drawRange.count=Math.min(n,t!==void 0?t:n,g.length),ee=0;ee<g.length;ee++)me=g[ee].current,me.getWorldPosition(it).applyMatrix4(ot),it.toArray(s,ee*3),c.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(h,ee*3),c.current.geometry.attributes.color.needsUpdate=!0,r.set([me.size],ee),c.current.geometry.attributes.size.needsUpdate=!0});const o=m.useMemo(()=>({getParent:()=>c,subscribe:u=>(v(d=>[...d,u]),()=>v(d=>d.filter(p=>p.current!==u.current)))}),[]);return m.createElement("points",Z({userData:{instances:g},matrixAutoUpdate:!1,ref:st([a,c]),raycast:()=>null},i),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:le}),m.createElement("bufferAttribute",{attach:"attributes-color",count:h.length/3,array:h,itemSize:3,usage:le}),m.createElement("bufferAttribute",{attach:"attributes-size",count:r.length,array:r,itemSize:1,usage:le})),m.createElement(Gn.Provider,{value:o},e))}),qn=m.forwardRef(({children:e,positions:t,colors:n,sizes:i,stride:a=3,...c},g)=>{const v=m.useRef(null);return Ce(()=>{const s=v.current.geometry.attributes;s.position.needsUpdate=!0,n&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),m.createElement("points",Z({ref:st([g,v])},c),m.createElement("bufferGeometry",null,m.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:le}),n&&m.createElement("bufferAttribute",{attach:"attributes-color",count:n.length/a,array:n,itemSize:3,usage:le}),i&&m.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:le})),e)}),cr=m.forwardRef((e,t)=>e.positions instanceof Float32Array?m.createElement(qn,Z({},e,{ref:t})):m.createElement(Un,Z({},e,{ref:t})));function ur({all:e,scene:t,camera:n}){const i=U(({gl:g})=>g),a=U(({camera:g})=>g),c=U(({scene:g})=>g);return m.useLayoutEffect(()=>{const g=[];e&&(t||c).traverse(h=>{h.visible===!1&&(g.push(h),h.visible=!0)}),i.compile(t||c,n||a);const v=new Jt(128);new Qt(.01,1e5,v).update(i,t||c),v.dispose(),g.forEach(h=>h.visible=!1)},[]),null}export{or as C,ir as H,ar as O,ur as P,Ct as a,Ce as b,cr as c,lr as d,sr as u};
